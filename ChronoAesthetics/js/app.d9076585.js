(function(){"use strict";var t={3837:function(t,e,i){var a=i(5130),r=i(6768);function s(t,e,i,a,s,n){const o=(0,r.g2)("router-view");return s.loaded?((0,r.uX)(),(0,r.Wv)(o,{key:0})):(0,r.Q3)("",!0)}var n=i(523),o=i(782);const l=(0,o.y$)({state:{data:null,mode:"newsCount"},mutations:{setData(t,e){t.data=e},setMode(t,e){t.mode=e}},actions:{},modules:{}});var h=l,d={name:"App",components:{},data(){return{loaded:!1}},computed:{},methods:{},mounted(){n.Pq9("./data.json").then((t=>{t=t.map((t=>({time:new Date(t["日期"].slice(0,4),t["日期"].slice(4,6)-1,t["日期"].slice(6,8)),newsCount:t["新闻总数"],imgCount:t["图片总数"],imgColor:t["颜色"],news:t["新闻"],inkratio:t["墨水比"]}))),h.state.data=t,this.loaded=!0}))}},c=i(1241);const u=(0,c.A)(d,[["render",s]]);var g=u,m=i(1387);const p={class:"home"};function f(t,e,i,a,s,n){const o=(0,r.g2)("Title"),l=(0,r.g2)("ModeSelector"),h=(0,r.g2)("Newspapers");return(0,r.uX)(),(0,r.CE)("svg",p,[(0,r.bF)(o,{transform:`translate(${n.paddingX}, ${n.paddingY})`,width:n.innerWidth,height:n.titleHeight,globalWidth:s.width,globalHeight:s.height},null,8,["transform","width","height","globalWidth","globalHeight"]),(0,r.bF)(l,{transform:`translate(${n.paddingX+.6*n.innerWidth}, ${n.paddingY})`,width:n.innerWidth,height:n.titleHeight,globalWidth:s.width,globalHeight:s.height},null,8,["transform","width","height","globalWidth","globalHeight"]),(0,r.bF)(h,{transform:`translate(${n.paddingX}, ${n.paddingY+n.titleHeight})`,width:n.innerWidth,height:n.newspapersHeight,globalWidth:s.width,globalHeight:s.height},null,8,["transform","width","height","globalWidth","globalHeight"])])}const w={id:"title"},x=["y","font-size"];function v(t,e,i,a,s,n){return(0,r.uX)(),(0,r.CE)("g",w,[(0,r.Lk)("text",{class:"maintitle",y:.15*n.titleFontsize,"dominant-baseline":"hanging","font-size":n.titleFontsize,"font-family":"HelveticaNeue","font-weight":"bold",style:{fill:"black"}},"人民日报头版图片可视化",8,x)])}var b={name:"Title",props:{width:{type:Number,default:0},height:{type:Number,default:0},globalHeight:{type:Number,default:0},globalWidth:{type:Number,default:0}},computed:{titleFontsize(){return 50*this.globalHeight/1080}}};const y=(0,c.A)(b,[["render",v]]);var k=y;const $=["transform"],C=["transform"],L=["transform"],Y=(0,r.Lk)("g",{id:"tooltip"},null,-1);function H(t,e,i,a,s,n){return(0,r.uX)(),(0,r.CE)("g",null,[(0,r.Lk)("g",{id:"axis-x",transform:`translate(${n.axisYWidth}, 0)`},null,8,$),(0,r.Lk)("g",{id:"axis-y",transform:`translate(0, ${n.axisXHeight})`},null,8,C),(0,r.Lk)("g",{id:"newspapers",transform:`translate(${n.axisYWidth}, ${n.axisXHeight})`},null,8,L),Y])}i(4114);class W{constructor(t,e,i=.1,a=.1,r="canlendar"){this.width=t,this.height=e,this.ratio=1/3,this.paddingX=i,this.paddingY=a,this.mode=r,this.preprocess()}preprocess(){if("calendar"===this.mode){let t,e,i=this.width/(366+365*this.paddingX),a=this.height/(80+79*this.paddingY);i/a>this.ratio?(i=a*this.ratio,t=i+(this.width-366*i)/365,e=a*(1+this.paddingY)):i/a<this.ratio?(a=i/this.ratio,t=i*(1+this.paddingX),e=a+(this.height-80*a)/79):(t=i*(1+this.paddingX),e=a*(1+this.paddingY)),this.dx=t,this.dy=e,this.dw=i,this.dh=a,console.log(this.dx,this.dy,this.dw,this.dh)}}getTransform(t){switch(this.mode){case"calendar":return this.getCanlendarTransform(t);default:return null}}getCanlendarTransform(t){const e=t.getFullYear(),i=new Date(e,0,1),a=Math.floor((t-i)/864e5);return{x:a*this.dx,y:(e-1946)*this.dy,width:this.dw,height:this.dh}}axisX(){switch(this.mode){case"calendar":return this.axisXCalendar();default:return null}}axisY(){switch(this.mode){case"calendar":return this.axisYCalendar();default:return null}}isLeapYear(t){return t%4===0&&t%100!==0||t%400===0}axisXCalendar(){let t=[],e=0;const i=[31,29,31,30,31,30,31,31,30,31,30,31];for(let a=0;a<12;a++)t.push({x:e+this.dw/2,width:this.dw,text:`${a+1}月1号`}),e+=this.dx*i[a];return t}axisYCalendar(){return new Array(79).fill(0).map(((t,e)=>{const i=1946+e;return{y:e*this.dy+this.dh/2,height:this.dh,text:`${i}年`}}))}}class X{constructor(t,e="newsCount"){this.data=t,this.mode=e,this.preprocess()}preprocess(){"newsCount"===this.mode?this.countScale=n.m4Y().domain([0,n.T9B(this.data,(t=>t.newsCount))]).range([0,1]):"imgCount"===this.mode?this.countScale=n.m4Y().domain([0,n.T9B(this.data,(t=>t.imgCount))]).range([0,1]):"inkratio"===this.mode?this.countScale=n.m4Y().domain([0,n.T9B(this.data,(t=>parseFloat(t.inkratio.replace("%",""))/100))]).range([0,1]):this.mode}draw(t,e,i){const a=t.datum();switch(this.mode){case"newsCount":return this.drawNewsCount(t,e,i,a);case"imgCount":return this.drawImgCount(t,e,i,a);case"inkratio":return this.drawInkRatio(t,e,i,a);case"imgColor":return this.drawImgColor(t,e,i,a);default:return null}}drawNewsCount(t,e,i,a){const r=n.dM(this.countScale(a.newsCount));n.KIW(r).l;t.append("rect").attr("width",e).attr("height",i).attr("fill",r)}drawImgCount(t,e,i,a){const r=n.dM(this.countScale(a.imgCount));n.KIW(r).l;t.append("rect").attr("width",e).attr("height",i).attr("fill",r)}drawInkRatio(t,e,i,a){const r=a.inkratio,s=parseFloat(r.replace("%","")),o=s.toFixed(0)+"%";console.log(o);const l=n.dM(this.countScale(s.toFixed(0)/100));n.KIW(l).l;t.append("rect").attr("width",e).attr("height",i).attr("fill",l)}drawImgColor(t,e,i,a){const r=a.imgColor[0]?a.imgColor[0].color:"white";console.log("Color: ",r),t.append("rect").attr("width",e).attr("height",i).attr("fill",r)}}var z={name:"Newspapers",components:{},data(){return{rows:0,columns:0,squareSize:0,textSize:0,marginX:0,marginY:0}},props:{width:{type:Number,default:0},height:{type:Number,default:0},globalWidth:{type:Number,default:0},globalHeight:{type:Number,default:0}},computed:{...(0,o.aH)({data:t=>t.data,mode:t=>t.mode}),size(){return{width:this.width,height:this.height}},globalX(){return void 0===this.$el?0:(this.size,this.$el.getBoundingClientRect().x)},globalY(){return void 0===this.$el?0:(this.size,this.$el.getBoundingClientRect().y)},axisXHeight(){return.03*this.height},axisYWidth(){return.02*this.width},innerWidth(){return this.width-this.axisYWidth},innerHeight(){return this.height-this.axisXHeight},layout(){return new W(this.innerWidth,this.innerHeight,.1,.1,"calendar")},newspaperDrawer(){return new X(this.data,this.mode)}},methods:{layout(){},draw(){this.drawAxis(),this.drawNewspapers()},drawAxis(){const t=n.Ltv(this.$el).select("#axis-x"),e=n.Ltv(this.$el).select("#axis-y"),i=.3*Math.min(this.axisXHeight,this.axisYWidth);t.selectAll("*").remove(),e.selectAll("*").remove(),t.append("line").attr("transform",`translate(0, ${.9*this.axisXHeight})`).attr("x1",0).attr("x2",this.innerWidth).attr("stroke","white").attr("stroke-width",1),t.selectAll(".tick").data(this.layout.axisX()).join("g").classed("tick",!0).attr("transform",(t=>`translate(${t.x}, ${.9*this.axisXHeight})`)).each(((t,e,a)=>{const r=n.Ltv(a[e]);r.append("line").attr("y2",.15*-this.axisXHeight).attr("stroke","white").attr("stroke-width",1),r.append("text").text(t.text).attr("y",.3*-this.axisXHeight).attr("text-anchor","middle").attr("font-size",i).attr("fill","black")})),e.append("line").attr("transform",`translate(${.9*this.axisYWidth}, 0)`).attr("y1",0).attr("y2",this.innerHeight).attr("stroke","white").attr("stroke-width",1),e.selectAll(".tick").data(this.layout.axisY()).join("g").classed("tick",!0).attr("transform",(t=>`translate(${.9*this.axisYWidth}, ${t.y})`)).each(((t,e,a)=>{const r=n.Ltv(a[e]);r.append("line").attr("x2",.15*-this.axisYWidth).attr("stroke","white").attr("stroke-width",1),r.append("text").text(t.text).attr("x",.25*-this.axisYWidth).attr("text-anchor","end").attr("alignment-baseline","middle").attr("font-size",i).attr("fill","black")}))},drawNewspapers(){n.Ltv(this.$el).select("#newspapers").selectAll(".newspaper").data(this.data,(t=>t)).join("g").classed("newspaper",!0).each(((t,e,i)=>{const a=n.Ltv(i[e]),r=this.getTransform(t.time);a.attr("transform",`translate(${r.x}, ${r.y})`),a.selectAll("*").remove(),this.drawNewspaper(a,r.width,r.height)}))},drawNewspaper(t,e,i){this.newspaperDrawer.draw(t,e,i),t.style("cursor","pointer").on("mouseenter",((e,i)=>{t.select("rect").attr("stroke","red");const a=e.clientX-this.globalX,r=e.clientY-this.globalY,s=.15*this.width,o=n.Ltv(this.$el).select("#tooltip");o.selectAll("*").remove();const l=o.append("g").attr("transform",`translate(${a}, ${r})`),h=i.time,d=`${h.getFullYear()}-${(h.getMonth()+1).toString().padStart(2,"0")}-${h.getDate().toString().padStart(2,"0")}`,c=l.append("image").attr("xlink:href",`http://127.0.0.1:14563/get-image?date=${d}`).attr("x",10).attr("y",10).attr("width",s).attr("preserveAspectRatio","xMidYMid meet");c.node().onload=()=>{const t=c.node().getBBox().height;c.attr("x",a+s>this.innerWidth?-s-10:10).attr("y",r+t>this.innerHeight?-t-10:10)}})).on("mousemove",((t,e)=>{const i=t.clientX-this.globalX,a=t.clientY-this.globalY;n.Ltv(this.$el).select("#tooltip").select("g").attr("transform",`translate(${i}, ${a})`)})).on("mouseleave",((e,i)=>{t.select("rect").attr("stroke",null),n.Ltv(this.$el).select("#tooltip").selectAll("*").remove()})).on("click",((t,e)=>{const i=e.time.toISOString().split("T")[0];this.$router.push(`/detail/${i}`)}))},getTransform(t){return this.layout.getTransform(t)}},mounted(){console.log("state",this.data),this.draw()},watch:{layout(){this.draw()},newspaperDrawer(){this.draw()}}};const A=(0,c.A)(z,[["render",H]]);var N=A;const S={id:"mode-selector"};function D(t,e,i,a,s,n){return(0,r.uX)(),(0,r.CE)("g",S)}var M={name:"Title",data(){return{modes:[{name:"颜色",value:"imgColor"},{name:"版面数量",value:"newsCount"},{name:"图片数量",value:"imgCount"},{name:"墨水比",value:"inkratio"}]}},props:{width:{type:Number,default:0},height:{type:Number,default:0},globalHeight:{type:Number,default:0},globalWidth:{type:Number,default:0}},computed:{...(0,o.aH)({mode:t=>t.mode}),size(){return{width:this.width,height:this.height}},fontsize(){return 20*this.globalHeight/1080}},methods:{...(0,o.PY)(["setMode"]),draw(){const t=n.Ltv("#mode-selector");let e=0;t.selectAll(".mode").data(this.modes).join("g").classed("mode",!0).each(((t,i,a)=>{const r=n.Ltv(a[i]);r.selectAll("*").remove();const s=r.append("g");s.append("circle").attr("cx",e+.5*this.fontsize).attr("cy",.5*this.height).attr("r",.5*this.fontsize).attr("fill","white").attr("stroke","black").attr("stroke-width",1),t.value===this.mode&&s.append("circle").attr("cx",e+.5*this.fontsize).attr("cy",.5*this.height).attr("r",.35*this.fontsize).style("fill","black"),e+=1.2*this.fontsize,r.append("text").text((t=>t.name)).attr("x",e).attr("y",.5*this.height).attr("font-size",this.fontsize).style("fill","black").style("dominant-baseline","middle"),e+=t.name.length*this.fontsize+this.fontsize})).style("cursor","pointer").on("click",((t,e)=>{this.setMode(e.value)}))}},mounted(){this.draw()},watch:{size(){this.draw()},mode(){this.draw()}}};const T=(0,c.A)(M,[["render",D]]);var F=T;const I=()=>document.getElementById("app").clientWidth,O=()=>document.getElementById("app").clientHeight;var j={name:"HomeView",components:{Title:k,Newspapers:N,ModeSelector:F},data(){return{width:I(),height:O()}},computed:{paddingX(){return 45*this.width/1080},paddingY(){return 54*this.height/1080},titleHeight(){return 80*this.height/1080},newspapersHeight(){return this.height-2*this.paddingY-this.titleHeight},innerWidth(){return this.width-2*this.paddingX},innerHeight(){return this.height-2*this.paddingY}},methods:{resize(){this.width=I(),this.height=O()}},mounted(){window.addEventListener("resize",this.resize.bind(this))}};const B=(0,c.A)(j,[["render",f]]);var E=B;const _={class:"detail-view"};function P(t,e,i,a,s,n){const o=(0,r.g2)("DetailPage");return(0,r.uX)(),(0,r.CE)("svg",_,[(0,r.bF)(o,{data:s.currentData,onClose:n.goBack},null,8,["data","onClose"])])}var R=i(4232);const q=t=>((0,r.Qi)("data-v-0faa2670"),t=t(),(0,r.jt)(),t),K={class:"detail-page"},Q={class:"header",transform:"translate(20, 20)"},U=q((()=>(0,r.Lk)("text",{x:"30",y:"17","text-anchor":"middle","alignment-baseline":"middle",fill:"white",class:"button-text"},"返回",-1))),V={class:"content",transform:"translate(20, 60)"},G={class:"image-container"},J=["href","width","height"],Z=["transform"],tt={class:"title",x:"0",y:"30","font-size":"24"},et={class:"info-grid",transform:"translate(0, 60)"},it={transform:"translate(0, 0)"},at=["fill"],rt=q((()=>(0,r.Lk)("text",{class:"label",x:"24",y:"0"},"颜色：",-1))),st={class:"value",x:"100",y:"0"},nt={transform:"translate(0, 40)"},ot=q((()=>(0,r.Lk)("text",{class:"label",x:"0",y:"0"},"新闻数量：",-1))),lt={class:"value",x:"100",y:"0"},ht={transform:"translate(0, 80)"},dt=q((()=>(0,r.Lk)("text",{class:"label",x:"0",y:"0"},"图片数量：",-1))),ct={class:"value",x:"100",y:"0"},ut={transform:"translate(0, 120)"},gt=q((()=>(0,r.Lk)("text",{class:"label",x:"0",y:"0"},"墨水比：",-1))),mt={class:"value",x:"100",y:"0"};function pt(t,e,i,a,s,n){return(0,r.uX)(),(0,r.CE)("svg",K,[(0,r.Lk)("g",null,[(0,r.Lk)("g",Q,[(0,r.Lk)("rect",{class:"back-button",x:"0",y:"0",width:"60",height:"30",rx:"4",onClick:e[0]||(e[0]=e=>t.$emit("close"))}),U]),(0,r.Lk)("g",V,[(0,r.Lk)("g",G,[(0,r.Lk)("image",{href:n.imageUrl,x:"0",y:"0",width:s.imageWidth,height:s.imageHeight,preserveAspectRatio:"xMidYMid meet"},null,8,J)]),(0,r.Lk)("g",{class:"info-container",transform:`translate(${s.imageWidth+30}, 0)`},[(0,r.Lk)("text",tt,(0,R.v_)(n.formatDate(i.data.time)),1),(0,r.Lk)("g",et,[(0,r.Lk)("g",it,[(0,r.Lk)("rect",{fill:i.data.imgColor[0].color,x:"0",y:"-13",width:"16",height:"16",rx:"2"},null,8,at),rt,(0,r.Lk)("text",st,(0,R.v_)(i.data.imgColor[0].color),1)]),(0,r.Lk)("g",nt,[ot,(0,r.Lk)("text",lt,(0,R.v_)(i.data.newsCount),1)]),(0,r.Lk)("g",ht,[dt,(0,r.Lk)("text",ct,(0,R.v_)(i.data.imgCount),1)]),(0,r.Lk)("g",ut,[gt,(0,r.Lk)("text",mt,(0,R.v_)(i.data.inkratio),1)])])],8,Z)])])])}var ft={name:"DetailPage",props:{data:{type:Object,required:!0}},data(){return{imageWidth:600,imageHeight:800}},computed:{imageUrl(){const t=this.data.time,e=`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`;return`http://127.0.0.1:14563/get-image?date=${e}`}},methods:{formatDate(t){return`${t.getFullYear()}年${t.getMonth()+1}月${t.getDate()}日`}}};const wt=(0,c.A)(ft,[["render",pt],["__scopeId","data-v-0faa2670"]]);var xt=wt,vt={name:"DetailView",components:{DetailPage:xt},data(){return{currentData:null}},methods:{goBack(){this.$router.push("/")}},created(){const t=this.$route.params.date;this.currentData=h.state.data.find((e=>e.time.toISOString().split("T")[0]===t)),this.currentData||this.goBack()}};const bt=(0,c.A)(vt,[["render",P],["__scopeId","data-v-661f2d06"]]);var yt=bt;const kt=[{path:"/",name:"home",component:E},{path:"/detail/:date",name:"detail",component:yt}],$t=(0,m.aE)({history:(0,m.Bt)(),routes:kt});var Ct=$t;(0,a.Ef)(g).use(h).use(Ct).mount("#app")}},e={};function i(a){var r=e[a];if(void 0!==r)return r.exports;var s=e[a]={exports:{}};return t[a].call(s.exports,s,s.exports,i),s.exports}i.m=t,function(){var t=[];i.O=function(e,a,r,s){if(!a){var n=1/0;for(d=0;d<t.length;d++){a=t[d][0],r=t[d][1],s=t[d][2];for(var o=!0,l=0;l<a.length;l++)(!1&s||n>=s)&&Object.keys(i.O).every((function(t){return i.O[t](a[l])}))?a.splice(l--,1):(o=!1,s<n&&(n=s));if(o){t.splice(d--,1);var h=r();void 0!==h&&(e=h)}}return e}s=s||0;for(var d=t.length;d>0&&t[d-1][2]>s;d--)t[d]=t[d-1];t[d]=[a,r,s]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var a in e)i.o(e,a)&&!i.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={524:0};i.O.j=function(e){return 0===t[e]};var e=function(e,a){var r,s,n=a[0],o=a[1],l=a[2],h=0;if(n.some((function(e){return 0!==t[e]}))){for(r in o)i.o(o,r)&&(i.m[r]=o[r]);if(l)var d=l(i)}for(e&&e(a);h<n.length;h++)s=n[h],i.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return i.O(d)},a=self["webpackChunkrmrb"]=self["webpackChunkrmrb"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=i.O(void 0,[504],(function(){return i(3837)}));a=i.O(a)})();
//# sourceMappingURL=app.d9076585.js.map