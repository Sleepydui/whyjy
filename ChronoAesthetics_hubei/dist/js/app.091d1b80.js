(()=>{"use strict";var t={3958:(t,e,n)=>{n(3792),n(3362),n(9085),n(9391);var a=n(5130),i=n(6768);function r(t,e,n,a,r,o){var s=(0,i.g2)("router-view");return r.loaded?((0,i.uX)(),(0,i.Wv)(s,{key:0})):(0,i.Q3)("",!0)}n(2062),n(4782),n(3288);var o=n(3549),s=n(1041),l=(0,s.y$)({state:{data:null,mode:"newsCount"},mutations:{setData:function(t,e){t.data=e},setMode:function(t,e){t.mode=e}},actions:{},modules:{}});const h=l,d={name:"App",components:{},data:function(){return{loaded:!1}},computed:{},methods:{},mounted:function(){var t=this;o.Pq9("./data.json").then((function(e){e=e.map((function(t){return{time:new Date(t["日期"].slice(0,4),t["日期"].slice(4,6)-1,t["日期"].slice(6,8)),newsCount:t["新闻总数"],imgCount:t["图片总数"],imgColor:t["颜色"],news:t["新闻"],inkratio:t["墨水比"]}})),h.state.data=e,t.loaded=!0}))}};var c=n(1241);const u=(0,c.A)(d,[["render",r]]),g=u;var f=n(1387),m=(n(8706),{class:"home"});function p(t,e,n,a,r,o){var s=(0,i.g2)("Title"),l=(0,i.g2)("ModeSelector"),h=(0,i.g2)("Newspapers");return(0,i.uX)(),(0,i.CE)("svg",m,[(0,i.bF)(s,{transform:"translate(".concat(o.paddingX,", ").concat(o.paddingY,")"),width:o.innerWidth,height:o.titleHeight,globalWidth:r.width,globalHeight:r.height},null,8,["transform","width","height","globalWidth","globalHeight"]),(0,i.bF)(l,{transform:"translate(".concat(o.paddingX+.6*o.innerWidth,", ").concat(o.paddingY,")"),width:o.innerWidth,height:o.titleHeight,globalWidth:r.width,globalHeight:r.height},null,8,["transform","width","height","globalWidth","globalHeight"]),(0,i.bF)(h,{transform:"translate(".concat(o.paddingX,", ").concat(o.paddingY+o.titleHeight,")"),width:o.innerWidth,height:o.newspapersHeight,globalWidth:r.width,globalHeight:r.height},null,8,["transform","width","height","globalWidth","globalHeight"])])}n(4170);var w={id:"title"},v=["y","font-size"];function x(t,e,n,a,r,o){return(0,i.uX)(),(0,i.CE)("g",w,[(0,i.Lk)("text",{class:"maintitle",y:.15*o.titleFontsize,"dominant-baseline":"hanging","font-size":o.titleFontsize,"font-family":"HelveticaNeue","font-weight":"bold",style:{fill:"black"}},"湖北日报头版图片可视化",8,v)])}n(2892);const y={name:"Title",props:{width:{type:Number,default:0},height:{type:Number,default:0},globalHeight:{type:Number,default:0},globalWidth:{type:Number,default:0}},computed:{titleFontsize:function(){return 50*this.globalHeight/1080}}},k=(0,c.A)(y,[["render",x]]),b=k;var C=["transform"],L=["transform"],Y=["transform"],H=(0,i.Lk)("g",{id:"tooltip"},null,-1);function W(t,e,n,a,r,o){return(0,i.uX)(),(0,i.CE)("g",null,[(0,i.Lk)("g",{id:"axis-x",transform:"translate(".concat(o.axisYWidth,", 0)")},null,8,C),(0,i.Lk)("g",{id:"axis-y",transform:"translate(0, ".concat(o.axisXHeight,")")},null,8,L),(0,i.Lk)("g",{id:"newspapers",transform:"translate(".concat(o.axisYWidth,", ").concat(o.axisXHeight,")")},null,8,Y),H])}var X=n(8653),A=(n(6918),n(8598),n(4114),n(1688),n(6099),n(8781),n(8156),n(5026)),z=n(9492),S=(n(3771),function(){function t(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"canlendar";(0,A.A)(this,t),this.width=e,this.height=n,this.ratio=1/3,this.paddingX=a,this.paddingY=i,this.mode=r,this.preprocess()}return(0,z.A)(t,[{key:"preprocess",value:function(){if("calendar"===this.mode){var t,e,n=this.width/(366+365*this.paddingX),a=this.height/(80+79*this.paddingY);n/a>this.ratio?(n=a*this.ratio,t=n+(this.width-366*n)/365,e=a*(1+this.paddingY)):n/a<this.ratio?(a=n/this.ratio,t=n*(1+this.paddingX),e=a+(this.height-80*a)/79):(t=n*(1+this.paddingX),e=a*(1+this.paddingY)),this.dx=t,this.dy=e,this.dw=n,this.dh=a,console.log(this.dx,this.dy,this.dw,this.dh)}}},{key:"getTransform",value:function(t){switch(this.mode){case"calendar":return this.getCanlendarTransform(t);default:return null}}},{key:"getCanlendarTransform",value:function(t){var e=t.getFullYear(),n=new Date(e,0,1),a=Math.floor((t-n)/864e5);return{x:a*this.dx,y:(e-2023)*this.dy,width:this.dw,height:this.dh}}},{key:"axisX",value:function(){switch(this.mode){case"calendar":return this.axisXCalendar();default:return null}}},{key:"axisY",value:function(){switch(this.mode){case"calendar":return this.axisYCalendar();default:return null}}},{key:"isLeapYear",value:function(t){return t%4===0&&t%100!==0||t%400===0}},{key:"axisXCalendar",value:function(){for(var t=[],e=0,n=[31,29,31,30,31,30,31,31,30,31,30,31],a=0;a<12;a++)t.push({x:e+this.dw/2,width:this.dw,text:"".concat(a+1,"月1号")}),e+=this.dx*n[a];return t}},{key:"axisYCalendar",value:function(){var t=this;return new Array(3).fill(0).map((function(e,n){var a=2023+n;return{y:n*t.dy+t.dh/2,height:t.dh,text:"".concat(a,"年")}}))}}]),t}()),N=(n(9868),n(8459),n(7495),n(5440),function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"newsCount";(0,A.A)(this,t),this.data=e,this.mode=n,this.preprocess()}return(0,z.A)(t,[{key:"preprocess",value:function(){"newsCount"===this.mode?this.countScale=o.m4Y().domain([0,o.T9B(this.data,(function(t){return t.newsCount}))]).range([0,1]):"imgCount"===this.mode?this.countScale=o.m4Y().domain([0,o.T9B(this.data,(function(t){return t.imgCount}))]).range([0,1]):"inkratio"===this.mode?this.countScale=o.m4Y().domain([0,o.T9B(this.data,(function(t){return parseFloat(t.inkratio.replace("%",""))/100}))]).range([0,1]):this.mode}},{key:"draw",value:function(t,e,n){var a=t.datum();switch(this.mode){case"newsCount":return this.drawNewsCount(t,e,n,a);case"imgCount":return this.drawImgCount(t,e,n,a);case"inkratio":return this.drawInkRatio(t,e,n,a);case"imgColor":return this.drawImgColor(t,e,n,a);default:return null}}},{key:"drawNewsCount",value:function(t,e,n,a){var i=o.dM(this.countScale(a.newsCount));o.KIW(i).l;t.append("rect").attr("width",e).attr("height",n).attr("fill",i)}},{key:"drawImgCount",value:function(t,e,n,a){var i=o.dM(this.countScale(a.imgCount));o.KIW(i).l;t.append("rect").attr("width",e).attr("height",n).attr("fill",i)}},{key:"drawInkRatio",value:function(t,e,n,a){var i=a.inkratio,r=parseFloat(i.replace("%","")),s=r.toFixed(0)+"%";console.log(s);var l=o.dM(this.countScale(r.toFixed(0)/100));o.KIW(l).l;t.append("rect").attr("width",e).attr("height",n).attr("fill",l)}},{key:"drawImgColor",value:function(t,e,n,a){var i=a.imgColor[0]?a.imgColor[0].color:"white";console.log("Color: ",i),t.append("rect").attr("width",e).attr("height",n).attr("fill",i)}}]),t}());const D={name:"Newspapers",components:{},data:function(){return{rows:0,columns:0,squareSize:0,textSize:0,marginX:0,marginY:0,zoomTransform:o.GSI}},props:{width:{type:Number,default:0},height:{type:Number,default:0},globalWidth:{type:Number,default:0},globalHeight:{type:Number,default:0}},computed:(0,X.A)((0,X.A)({},(0,s.aH)({data:function(t){return t.data},mode:function(t){return t.mode}})),{},{size:function(){return{width:this.width,height:this.height}},globalX:function(){return void 0===this.$el?0:(this.size,this.$el.getBoundingClientRect().x)},globalY:function(){return void 0===this.$el?0:(this.size,this.$el.getBoundingClientRect().y)},axisXHeight:function(){return.03*this.height},axisYWidth:function(){return.02*this.width},innerWidth:function(){return this.width-this.axisYWidth},innerHeight:function(){return this.height-this.axisXHeight},layout:function(){return new S(this.innerWidth,this.innerHeight,.1,.1,"calendar")},newspaperDrawer:function(){return new N(this.data,this.mode)}}),methods:{layout:function(){},draw:function(){this.drawAxis(),this.drawNewspapers()},drawAxis:function(){var t=this,e=o.Ltv(this.$el).select("#axis-x"),n=o.Ltv(this.$el).select("#axis-y"),a=.3*Math.min(this.axisXHeight,this.axisYWidth);e.selectAll("*").remove(),n.selectAll("*").remove(),e.append("line").attr("transform","translate(0, ".concat(.9*this.axisXHeight,")")).attr("x1",0).attr("x2",this.innerWidth).attr("stroke","white").attr("stroke-width",1),e.selectAll(".tick").data(this.layout.axisX()).join("g").classed("tick",!0).attr("transform",(function(e){return"translate(".concat(e.x,", ").concat(.9*t.axisXHeight,")")})).each((function(e,n,i){var r=o.Ltv(i[n]);r.append("line").attr("y2",.15*-t.axisXHeight).attr("stroke","white").attr("stroke-width",1),r.append("text").text(e.text).attr("y",.3*-t.axisXHeight).attr("text-anchor","middle").attr("font-size",a).attr("fill","black")})),n.append("line").attr("transform","translate(".concat(.9*this.axisYWidth,", 0)")).attr("y1",0).attr("y2",this.innerHeight).attr("stroke","white").attr("stroke-width",1),n.selectAll(".tick").data(this.layout.axisY()).join("g").classed("tick",!0).attr("transform",(function(e){return"translate(".concat(.9*t.axisYWidth,", ").concat(e.y,")")})).each((function(e,n,i){var r=o.Ltv(i[n]);r.append("line").attr("x2",.15*-t.axisYWidth).attr("stroke","white").attr("stroke-width",1),r.append("text").text(e.text).attr("x",.25*-t.axisYWidth).attr("text-anchor","end").attr("alignment-baseline","middle").attr("font-size",a).attr("fill","black")}))},drawNewspapers:function(){var t=this;o.Ltv(this.$el).select("#newspapers").selectAll(".newspaper").data(this.data,(function(t){return t})).join("g").classed("newspaper",!0).each((function(e,n,a){var i=o.Ltv(a[n]),r=t.getTransform(e.time);i.attr("transform","translate(".concat(r.x,", ").concat(r.y,")")),i.selectAll("*").remove(),t.drawNewspaper(i,r.width,r.height)}))},drawNewspaper:function(t,e,n){var a=this;this.newspaperDrawer.draw(t,e,n),t.style("cursor","pointer").on("mouseenter",(function(e,n){t.select("rect").attr("stroke","red");var i=e.clientX-a.globalX,r=e.clientY-a.globalY,s=.15*a.width,l=o.Ltv(a.$el).select("#tooltip");l.selectAll("*").remove();var h=l.append("g").attr("transform","translate(".concat(i,", ").concat(r,")")),d=n.time,c="".concat(d.getFullYear(),"-").concat((d.getMonth()+1).toString().padStart(2,"0"),"-").concat(d.getDate().toString().padStart(2,"0")),u=h.append("image").attr("xlink:href","http://127.0.0.1:14563/get-image?date=".concat(c)).attr("x",10).attr("y",10).attr("width",s).attr("preserveAspectRatio","xMidYMid meet");u.node().onload=function(){var t=u.node().getBBox().height;u.attr("x",i+s>a.innerWidth?-s-10:10).attr("y",r+t>a.innerHeight?-t-10:10)}})).on("mousemove",(function(t,e){var n=t.clientX-a.globalX,i=t.clientY-a.globalY;o.Ltv(a.$el).select("#tooltip").select("g").attr("transform","translate(".concat(n,", ").concat(i,")"))})).on("mouseleave",(function(e,n){t.select("rect").attr("stroke",null),o.Ltv(a.$el).select("#tooltip").selectAll("*").remove()})).on("click",(function(t,e){var n=e.time.toISOString().split("T")[0];a.$router.push("/detail/".concat(n))}))},getTransform:function(t){return this.layout.getTransform(t)},initZoom:function(){var t=this,e=o.Ltv(this.$el),n=e.select("#newspapers"),a=o.s_O().scaleExtent([.5,5]).on("zoom",(function(e){t.zoomTransform=e.transform,n.attr("transform",e.transform)}));e.call(a)}},mounted:function(){this.initZoom(),console.log("state",this.data),this.draw()},watch:{layout:function(){this.draw()},newspaperDrawer:function(){this.draw()}}},T=(0,c.A)(D,[["render",W]]),M=T;var F={id:"mode-selector"};function I(t,e,n,a,r,o){return(0,i.uX)(),(0,i.CE)("g",F)}n(2010),n(9546);const $={name:"Title",data:function(){return{modes:[{name:"颜色",value:"imgColor"},{name:"版面数量",value:"newsCount"},{name:"图片数量",value:"imgCount"},{name:"墨水比",value:"inkratio"}]}},props:{width:{type:Number,default:0},height:{type:Number,default:0},globalHeight:{type:Number,default:0},globalWidth:{type:Number,default:0}},computed:(0,X.A)((0,X.A)({},(0,s.aH)({mode:function(t){return t.mode}})),{},{size:function(){return{width:this.width,height:this.height}},fontsize:function(){return 20*this.globalHeight/1080}}),methods:(0,X.A)((0,X.A)({},(0,s.PY)(["setMode"])),{},{draw:function(){var t=this,e=o.Ltv("#mode-selector"),n=0;e.selectAll(".mode").data(this.modes).join("g").classed("mode",!0).each((function(e,a,i){var r=o.Ltv(i[a]);r.selectAll("*").remove();var s=r.append("g");s.append("circle").attr("cx",n+.5*t.fontsize).attr("cy",.5*t.height).attr("r",.5*t.fontsize).attr("fill","white").attr("stroke","black").attr("stroke-width",1),e.value===t.mode&&s.append("circle").attr("cx",n+.5*t.fontsize).attr("cy",.5*t.height).attr("r",.35*t.fontsize).style("fill","black"),n+=1.2*t.fontsize,r.append("text").text((function(t){return t.name})).attr("x",n).attr("y",.5*t.height).attr("font-size",t.fontsize).style("fill","black").style("dominant-baseline","middle"),n+=e.name.length*t.fontsize+t.fontsize})).style("cursor","pointer").on("click",(function(e,n){t.setMode(n.value)}))}}),mounted:function(){this.draw()},watch:{size:function(){this.draw()},mode:function(){this.draw()}}},O=(0,c.A)($,[["render",I]]),j=O;var B=function(){return document.getElementById("app").clientWidth},E=function(){return document.getElementById("app").clientHeight};const _={name:"HomeView",components:{Title:b,Newspapers:M,ModeSelector:j},data:function(){return{width:B(),height:E()}},computed:{paddingX:function(){return 45*this.width/1080},paddingY:function(){return 54*this.height/1080},titleHeight:function(){return 80*this.height/1080},newspapersHeight:function(){return this.height-2*this.paddingY-this.titleHeight},innerWidth:function(){return this.width-2*this.paddingX},innerHeight:function(){return this.height-2*this.paddingY}},methods:{resize:function(){this.width=B(),this.height=E()}},mounted:function(){window.addEventListener("resize",this.resize.bind(this))}},P=(0,c.A)(_,[["render",p]]),R=P;var q={class:"detail-view"};function K(t,e,n,a,r,o){var s=(0,i.g2)("DetailPage");return(0,i.uX)(),(0,i.CE)("svg",q,[(0,i.bF)(s,{data:r.currentData,onClose:o.goBack},null,8,["data","onClose"])])}n(113);var Q=n(4232),U=function(t){return(0,i.Qi)("data-v-0faa2670"),t=t(),(0,i.jt)(),t},V={class:"detail-page"},Z={class:"header",transform:"translate(20, 20)"},G=U((function(){return(0,i.Lk)("text",{x:"30",y:"17","text-anchor":"middle","alignment-baseline":"middle",fill:"white",class:"button-text"},"返回",-1)})),J={class:"content",transform:"translate(20, 60)"},tt={class:"image-container"},et=["href","width","height"],nt=["transform"],at={class:"title",x:"0",y:"30","font-size":"24"},it={class:"info-grid",transform:"translate(0, 60)"},rt={transform:"translate(0, 0)"},ot=["fill"],st=U((function(){return(0,i.Lk)("text",{class:"label",x:"24",y:"0"},"颜色：",-1)})),lt={class:"value",x:"100",y:"0"},ht={transform:"translate(0, 40)"},dt=U((function(){return(0,i.Lk)("text",{class:"label",x:"0",y:"0"},"新闻数量：",-1)})),ct={class:"value",x:"100",y:"0"},ut={transform:"translate(0, 80)"},gt=U((function(){return(0,i.Lk)("text",{class:"label",x:"0",y:"0"},"图片数量：",-1)})),ft={class:"value",x:"100",y:"0"},mt={transform:"translate(0, 120)"},pt=U((function(){return(0,i.Lk)("text",{class:"label",x:"0",y:"0"},"墨水比：",-1)})),wt={class:"value",x:"100",y:"0"};function vt(t,e,n,a,r,o){return(0,i.uX)(),(0,i.CE)("svg",V,[(0,i.Lk)("g",null,[(0,i.Lk)("g",Z,[(0,i.Lk)("rect",{class:"back-button",x:"0",y:"0",width:"60",height:"30",rx:"4",onClick:e[0]||(e[0]=function(e){return t.$emit("close")})}),G]),(0,i.Lk)("g",J,[(0,i.Lk)("g",tt,[(0,i.Lk)("image",{href:o.imageUrl,x:"0",y:"0",width:r.imageWidth,height:r.imageHeight,preserveAspectRatio:"xMidYMid meet"},null,8,et)]),(0,i.Lk)("g",{class:"info-container",transform:"translate(".concat(r.imageWidth+30,", 0)")},[(0,i.Lk)("text",at,(0,Q.v_)(o.formatDate(n.data.time)),1),(0,i.Lk)("g",it,[(0,i.Lk)("g",rt,[(0,i.Lk)("rect",{fill:n.data.imgColor[0].color,x:"0",y:"-13",width:"16",height:"16",rx:"2"},null,8,ot),st,(0,i.Lk)("text",lt,(0,Q.v_)(n.data.imgColor[0].color),1)]),(0,i.Lk)("g",ht,[dt,(0,i.Lk)("text",ct,(0,Q.v_)(n.data.newsCount),1)]),(0,i.Lk)("g",ut,[gt,(0,i.Lk)("text",ft,(0,Q.v_)(n.data.imgCount),1)]),(0,i.Lk)("g",mt,[pt,(0,i.Lk)("text",wt,(0,Q.v_)(n.data.inkratio),1)])])],8,nt)])])])}const xt={name:"DetailPage",props:{data:{type:Object,required:!0}},data:function(){return{imageWidth:600,imageHeight:800}},computed:{imageUrl:function(){var t=this.data.time,e="".concat(t.getFullYear(),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getDate().toString().padStart(2,"0"));return"http://127.0.0.1:14563/get-image?date=".concat(e)}},methods:{formatDate:function(t){return"".concat(t.getFullYear(),"年").concat(t.getMonth()+1,"月").concat(t.getDate(),"日")}}},yt=(0,c.A)(xt,[["render",vt],["__scopeId","data-v-0faa2670"]]),kt=yt,bt={name:"DetailView",components:{DetailPage:kt},data:function(){return{currentData:null}},methods:{goBack:function(){this.$router.push("/")}},created:function(){var t=this.$route.params.date;this.currentData=h.state.data.find((function(e){return e.time.toISOString().split("T")[0]===t})),this.currentData||this.goBack()}},Ct=(0,c.A)(bt,[["render",K],["__scopeId","data-v-661f2d06"]]),Lt=Ct;var Yt=[{path:"/",name:"home",component:R},{path:"/detail/:date",name:"detail",component:Lt}],Ht=(0,f.aE)({history:(0,f.Bt)(),routes:Yt});const Wt=Ht;(0,a.Ef)(g).use(h).use(Wt).mount("#app")}},e={};function n(a){var i=e[a];if(void 0!==i)return i.exports;var r=e[a]={exports:{}};return t[a].call(r.exports,r,r.exports,n),r.exports}n.m=t,(()=>{var t=[];n.O=(e,a,i,r)=>{if(!a){var o=1/0;for(d=0;d<t.length;d++){for(var[a,i,r]=t[d],s=!0,l=0;l<a.length;l++)(!1&r||o>=r)&&Object.keys(n.O).every((t=>n.O[t](a[l])))?a.splice(l--,1):(s=!1,r<o&&(o=r));if(s){t.splice(d--,1);var h=i();void 0!==h&&(e=h)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[a,i,r]}})(),(()=>{n.n=t=>{var e=t&&t.__esModule?()=>t["default"]:()=>t;return n.d(e,{a:e}),e}})(),(()=>{n.d=(t,e)=>{for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}})(),(()=>{n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()})(),(()=>{n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)})(),(()=>{var t={524:0};n.O.j=e=>0===t[e];var e=(e,a)=>{var i,r,[o,s,l]=a,h=0;if(o.some((e=>0!==t[e]))){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(l)var d=l(n)}for(e&&e(a);h<o.length;h++)r=o[h],n.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return n.O(d)},a=self["webpackChunkrmrb"]=self["webpackChunkrmrb"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))})();var a=n.O(void 0,[504],(()=>n(3958)));a=n.O(a)})();
//# sourceMappingURL=app.091d1b80.js.map